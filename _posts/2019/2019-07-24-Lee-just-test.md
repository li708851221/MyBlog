---
layout: post
title: 自助报表系统-使用文档
category: springboot
tags: [springboot]
keywords: Spring Boot

##1 进入系统
报表平台部署成功后，进入HIS系统的角色权限管理系统，给用户分配角色"自助报表系统"。    
返回HIS登录页面，点击"自助报表系统"进入新报表平台页面。  
推荐使用浏览器：众阳浏览器，360极速浏览器。  
![](自助报表系统使用文档.files/image001.jpg)
![](自助报表系统使用文档.files/image002.jpg)
 
## 2 平台使用
### 2.1 基础数据维护
首次使用自助报表系统，需要根据医院实际服务器IP，数据库IP等信息进行配置。配置内容分为三部分。    
#### 2.1.1 维护数据库信息
点击打开"服务器管理-数据库维护"菜单。新报表平台默认存在一条64服务器数据库连接信息。双击此条信息后，数据库信息在页面头部位置显示。将数据库信息修改为医院实际数据库信息，点击修改按钮提交修改内容。  
#### 2.1.2 维护HIS IIS服务器信息
点击打开"服务器管理-服务器维护"菜单。新报表平台默认存在一条64服务器信息。双击此条信息后，IIS服务器信息在页面头部位置显示。将服务器信息修改为医院实际服务器信息，点击修改按钮提交修改内容。
#### 2.1.3 初始化-报表迁移
目的：新部署报表系统使用时，对已存在于报表平台的报表进行数据库连接重置。    
1.在系统公告页面，点击系统设置按钮。弹出重置报表连接信息窗口。填写相应信息。    
![](自助报表系统使用文档.files/image003.jpg)  
![](自助报表系统使用文档.files/image004.jpg)   
![](自助报表系统使用文档.files/image005.jpg)   
文件夹路径：      
WINDOWS系统下：进入新报表平台服务器，进入报表平台对应tomcat下的webapps-grf 文件夹。复制grf文件夹路E:\msunreport\apache-tomcat-8.5.4\webapps\grf，粘贴到文件夹路径文本框中。      
Linux系统下：严格按照部署文档部署路径为 /msun/app/msunreport/ apache-tomcat-8.5.38/webapps/grf，如安装时路径有变动请按照修改后路径填写。      
新IP地址：现报表文件对应HIS数据库连接IP。      
新用户名：现报表文件对应HIS数据库用户名。      
新密码：现报表文件对应HIS数据库密码。      
新IP端口：当前医院报表平台IP和端口，例如10.68.4.64:7010。      
信息填写完成，点击下方"重置"按钮，进行信息重置。等待页面提示"成功"，报表连接信息重置完成。       
![](自助报表系统使用文档.files/image006.jpg)       
2.进入报表设计-报表仓库页面，修改底部条数到最大数量，点击页面上方全选按钮，选中所有报表。点击重新生成报表，在弹窗中选择插件报表点击生成按钮，系统将根据重置后的数据库连接信息对报表进行重新生成。    
![](自助报表系统使用文档.files/image007.jpg)       
![](自助报表系统使用文档.files/image008.jpg)       
![](自助报表系统使用文档.files/image009.jpg)       
### 2.2报表制作    
#### 2.2.1 示例一_门诊费用明细（简单明细报表）  
![](自助报表系统使用文档.files/image010.jpg)    
##### 1.维护数据集-简单数据集操作  
![](自助报表系统使用文档.files/image011.jpg)       
进入数据集维护页面，点击"新增"按钮。通过检索功能，输入"费用"回车查询出需要的数据集"门诊费用明细数据源",选中。在后两个下拉框中分别选择"HIS数据库"和"报表数据"。点击"保存"按钮，完成新增数据集操作。点击页面下方的"关闭"按钮回到数据集列表页面。    
![](自助报表系统使用文档.files/image012.jpg)     
![](自助报表系统使用文档.files/image013.jpg)    
通过检索功能找到刚刚新增的"示例一_门诊费用明细"数据集，双击此条数据，进入数据集  
![](自助报表系统使用文档.files/image014.png)     
![](自助报表系统使用文档.files/image015.jpg)    
在"显示字段设置"中，勾选报表所需字段（就诊卡号，患者姓名，费用分类，费用名称，数量，单价，金额…）。  
![](自助报表系统使用文档.files/image016.jpg)     
点击上方"查询字段设置"，切换到条件页签。选择费用创建时间、发票分类ID、费用ID、门诊卡号作为查询条件。  
![](自助报表系统使用文档.files/image017.jpg)      
点击保存按钮。提示"保存成功"，下方出现脚本预览。数据集维护完成    
##### 2.制作报表-数据明细报表制作向导  
![](自助报表系统使用文档.files/image018.jpg)    
进入报表设计向导页面。填写名称、标签和备注内容，选择类型为"明细报表"，选择使用场景为"门诊医生站"。  
![](自助报表系统使用文档.files/image019.jpg)     
点击"下一步"按钮进入选择数据集步骤。通过检索找到"示例一_门诊费用明细"数据集。点击"标题设置"按钮。弹出"列顺序及属性设置"窗口。  
![](自助报表系统使用文档.files/image020.jpg)    
![](自助报表系统使用文档.files/image021.jpg)    
1列表题右键可以添加自由列。  
![](自助报表系统使用文档.files/image022.jpg)    
2点击红框中单一字段，可对列标题名称进行修改。    
3使用鼠标左键可以拖拽进行位置移动。  
![](自助报表系统使用文档.files/image023.jpg)     
调整完毕后如上图所示。首先点击"保存"按钮保存报表列的设置，然后点击"关闭"按钮，关闭弹窗，回到向导。  
![](自助报表系统使用文档.files/image024.jpg)     
点击下一步，进入"查询条件设置"界面。  
![](自助报表系统使用文档.files/image025.jpg)     
使用鼠标拖拽左侧"查询条件集合"中的条件字段到紫色框中。点击编辑按钮对每一个条件进行设置。  
![](自助报表系统使用文档.files/image026.jpg)     
费用创建时间：在类型中下拉选择日期组，修改自定义标签中的文本为"查询时间"。点击确定按钮保存，并退出编辑状态。  
![](自助报表系统使用文档.files/image027.jpg)     
费用分类ID：在类型下拉框中选择"下拉菜单"，修改自定义标签为"费用分类"。是否隐藏，默认为"否"。运算符合默认运算符默认"等于"。默认勾选"是否添加全部项"。勾选"数据集模式"切换到数据集模式。  
![](自助报表系统使用文档.files/image028.jpg)     
在数据集检索框中，检索选中发票分类字典。  
![](自助报表系统使用文档.files/image029.jpg)         
值字段选择"项目ID"，显示字段选择"项目名称"。  
![](自助报表系统使用文档.files/image030.jpg)  
![](自助报表系统使用文档.files/image031.jpg)    
![](自助报表系统使用文档.files/image032.jpg)    
最后完成设计效果如上图所示。  
  
费用ID：在类型下拉框中选择"检索框"，修改自定义标签为"费用名称"。  
![](自助报表系统使用文档.files/image033.jpg)               
在数据集检索框中，检索选中计价费用信息字典。值字段选中费用ID。显示字段依次选择费用名称、费用编码、简拼。（注意此处选择顺序，选中后默认第一个选中字段展示在文本框中）  
![](自助报表系统使用文档.files/image034.jpg)  
![](自助报表系统使用文档.files/image035.jpg) 
![](自助报表系统使用文档.files/image036.jpg) 
![](自助报表系统使用文档.files/image037.jpg)        
最后完成设计效果如上图所示。   
门诊卡号：修改自定义标签为"就诊卡号"，其他我们维持默认的文本类型不变。     
![](自助报表系统使用文档.files/image038.jpg)      
设置完所有条件后，继续点击下一步。  
注意：查询集合中的条件字段不需要全部拖拽设置，我们根据实际需要选择要用的条件字段设置即可。  
![](自助报表系统使用文档.files/image039.jpg)      
点击下一步后我们能看到目前的报表样式预览。如果有需要修改的地方，可以点击"上一步"按钮，或者左侧导航栏跳转到对应页面进行修改。  
报表样式确认无误后，点击"完成"按钮，页面跳转到报表设计器页面。  
##### 3.制作报表-调整报表样式  
![](自助报表系统使用文档.files/image040.jpg)      
进入报表编辑界面后，报表基本内容已经生成出来。只需要对样式进行调整，就可以制作完成一张新的报表。（具体锐浪报表编辑器样式调整，此处不再进行说明，可以参考锐浪报表的帮助文档进行学习。）  
##### 4.制作报表-报表生成、预览  
通过1-3步骤，一个简单的报表已经设计完成。  
![](自助报表系统使用文档.files/image041.jpg)      
点击"生成查询视图报表"。页面右侧出现自动生成的url地址。(生成查询视图报表,对应生成锐浪查询视图样式。生成预览视图报表,对应生成锐浪预览视图样式。)  
![](自助报表系统使用文档.files/image042.jpg)   
![](自助报表系统使用文档.files/image043.jpg)    
点击"查看预览报表url"，浏览器在新页签中打开报表页面。  
![](自助报表系统使用文档.files/image044.jpg) 
![](自助报表系统使用文档.files/image045.jpg)       
通过以上步骤，我们已经制作完成一个可使用的报表。  
下面我们对报表进行修改。1把这个报表变成按科室进行限制查询的报表，2变更字段"费用金额"为"实收金额"。  
##### 5.数据集修改  
![](自助报表系统使用文档.files/image046.jpg)        
在报表设计器页面，点击"数据集修改"按钮（也可在数据集页面双击进入修改），进入数据集维护界面。在显示字段设置中，勾选"实际支付金额"。在查询字段设置中，勾选"开单科室ID"。点击"保存"按钮保存修改。关掉页签，回到"报表设计器"。     
![](自助报表系统使用文档.files/image047.jpg) 
![](自助报表系统使用文档.files/image048.jpg)      
回到"报表设计器"页面，F5键刷新一下页面。将数据集修改信息同步过来。    
![](自助报表系统使用文档.files/image049.jpg)       
点击"明细数据"按钮，选择"更新生成"方式。    
![](自助报表系统使用文档.files/image050.jpg)  
![](自助报表系统使用文档.files/image051.jpg)             
此时查看记录集列表，修改已同步到记录集。修改报表文件替换字段。      
注意：如果只是增加查询字段，不必点击"明细数据"按钮更新报表数据集。      
##### 6.修改设计查询表单      
我们已经在数据集中增加了开单科室id这个字段，现在到查询表单设计页面添加上这个条件。      
![](自助报表系统使用文档.files/image052.jpg)   
点击"查询表单"按钮进入表单设计页签。可以看到左侧列表中已有"开单科室ID"字段，拖拽它进入编辑区域。  
![](自助报表系统使用文档.files/image053.jpg)  
![](自助报表系统使用文档.files/image054.jpg)
![](自助报表系统使用文档.files/image055.jpg)      
![](自助报表系统使用文档.files/image056.jpg)        
开单科室ID：在类型下拉框中选择"url传参"，默认值选择"科室ID"。点击确定保存。      
点击上方确定按钮对表单进行保存后，关闭页签，回到报表设计器页面。      
##### 7.自定义报表参数      
医院提出新的需求，查询时要求将选择时间段内的就诊人次也展示出来。      
先写好取这条数据的sql脚本。   
     
```sql
SELECT COUNT(1) 就诊人次 FROM MZ.OUT.REGISTERS WITH(NOLOCK)
WHERE DEPT_ID='' AND REGISTER_TIME >='' AND REGISTER_TIME<=''
```    

![](自助报表系统使用文档.files/image057.jpg)     
 
复制SQL语句到图片中"参数数据源"位置，填写本条脚本标题。    
光标移动到需要插入条件的位置，右键选择需要插入的条件字段。      
注意：插入条件字段时不要保留单引号。    
![](自助报表系统使用文档.files/image058.jpg)
![](自助报表系统使用文档.files/image059.jpg)  
  
```sql   
SELECT COUNT(1) 就诊人次 FROM MZ.OUT.REGISTERS WITH(NOLOCK)
WHERE DEPT_ID= #{DEPT_ID} AND REGISTER_TIME >=#{start_费用创建时间}  AND REGISTER_TIME<=#{end_费用创建时间}
```
  

摘出设计好的参数脚本如上。    
![](自助报表系统使用文档.files/image060.jpg)
![](自助报表系统使用文档.files/image061.jpg)
![](自助报表系统使用文档.files/image062.jpg)     
点击保存按钮，保存此条参数sql。点击"报表参数"同步到报表参数列表中。    
![](自助报表系统使用文档.files/image063.jpg)    
修改报表文件，添加展示信息。点击"生成查询视图报表"按钮重新生成报表页面。    
重新按报表url加上userSysId打开报表页面，查询效果如下。    
![](自助报表系统使用文档.files/image064.jpg)    
##### 8. 报表发布    
1 可以复制出报表url，使用各系统菜单添加功能进行菜单添加。    
2在报表仓库菜单中，点击"发布"按钮，弹出报表发布窗口，选择好菜单位置，填写菜单信息后保存。（目前只支持HIS菜单）    
![](自助报表系统使用文档.files/image065.jpg)   
![](自助报表系统使用文档.files/image066.jpg)    
#### 2.2.2 示例二_门诊收入汇总（交叉表）
![](自助报表系统使用文档.files/image067.jpg)   
##### 1.维护数据集-聚合脚本数据集    
![](自助报表系统使用文档.files/image068.png)   
![](自助报表系统使用文档.files/image069.jpg)    
2.进入数据集维护页面，点击"新增"按钮。通过检索功能，输入"费用"回车查询出需要的数据集"门诊_费用明细数据源"，选中。在后两个下拉框中分别选择"HIS数据库"和"报表数据"。点击"保存"按钮，完成新增数据集操作。点击页面下方的"关闭"按钮回到数据集列表页面。    
3.找到刚刚新增的"示例二_门诊收入汇总 "数据集，双击此条数据，进入数据集维护界面。    
![](自助报表系统使用文档.files/image070.png)   
![](自助报表系统使用文档.files/image071.jpg)    
在分组下拉框中选择 发票分类ID，发票分类名称，开单科室ID，开单科室。（可以使用检索功能快速查询出字段）。    
![](自助报表系统使用文档.files/image072.jpg)     
在显示字段设置中，勾选发票分类ID，发票分类名称，开单科室ID，开单科室。    
![](自助报表系统使用文档.files/image073.jpg)   
点击添加聚合字段按钮，进入弹窗，在左侧选择 "实际支付金额"字段，在右侧下拉框中选择"求和函数"，点击"增加"按钮。关闭弹窗。    
![](自助报表系统使用文档.files/image074.jpg)   
在显示字段最下方找到新增的聚合函数字段。选中后在右侧字段属性设置中选择"四舍五入函数"，字内置函数参数填写2代表保留两位小数。    
![](自助报表系统使用文档.files/image075.jpg)   
完成以上设置后点击保存按钮。提示"保存成功"，下方出现脚本预览。数据集维护完成。    
![](自助报表系统使用文档.files/image076.jpg)   
##### 2.制作报表-交叉表制作向导    
![](自助报表系统使用文档.files/image077.jpg)   
进入报表设计向导页面。填写名称、标签和备注内容。选择报表样式为"交叉报表"，选择报表用途"业务查询"，选择报表场景为 "门诊医生站"。    
![](自助报表系统使用文档.files/image078.jpg)   
点击"下一步"按钮进入选择数据集步骤。找到"示例二_门诊收入汇总"数据集。点击"标题设置"按钮。弹出"列顺序及属性设置"窗口。    
![](自助报表系统使用文档.files/image079.jpg)   
![](自助报表系统使用文档.files/image080.jpg)   
点击选中列标题，在属性设置中对交叉表属性进行设置。点击确定按钮进行保存。    
删除不再需要的列，只保留开单科室列。在列表题上右击，添加两个自由列标题。    
![](自助报表系统使用文档.files/image081.jpg)    
选中第一个自由列标题，列标题名称选择发票分类名称字段，字段名称选择实际支付金额字段，点击确定保存。    
![](自助报表系统使用文档.files/image082.jpg)     
选择第二个组合列，列标题名称修改为合计，字段名称选择实际支付金额字段。点击确定保存。    
![](自助报表系统使用文档.files/image083.jpg)     
调整完毕后如上图所示。点击"保存"按钮，关闭弹窗，回到向导。    
![](自助报表系统使用文档.files/image084.jpg)     
点击下一步，在查询条件设置中，设置费用创建时间为"日期组"样式。继续点击下一步。    
![](自助报表系统使用文档.files/image085.jpg)     
预览报表信息，此时如有错误可以通过"上一步"按钮返回修改。
确定无误后，点击确定按钮，进入报表设计器页面。    
##### 3.制作报表-完善内容    
参考示例一中3-10步骤的内容，对报表样式，查询表单，参数进行设计。    
![](自助报表系统使用文档.files/image086.jpg)     
![](自助报表系统使用文档.files/image087.jpg)     
#### 2.2.3 示例三_子报表
##### 1.准备数据集    
首先按照示例一和示例二中的内容创建好"示例三_子报表数据集1"和"示例三_子报表数据集2"数据集。    
示例三_子报表数据集1 脚本：     

```sql   
SELECT 开单科室, 开单科室ID, ROUND(SUM(实际支付金额),2) 实际支付金额_ZDY FROM [ZYREPORTDS].[dbo].[门诊_费用明细视图_LV0] WITH(NOLOCK)WHERE 1=1#{WHERE} GROUP BY 开单科室,开单科室ID
```  

条件为：费用创建时间
示例三_子报表数据集2 脚本：  

```sql
SELECT 单价, 患者姓名, 费用分类, 费用名称, 门诊卡号, 开单医生名称, 开单科室, 执行科室名称, SUM(实际支付金额) 实际支付金额_ZDY, SUM(数量) 数量_ZDYFROM [ZYREPORTDS].[dbo].[门诊_费用明细视图_LV0] WITH(NOLOCK) WHERE 1=1#{WHERE} GROUP BY 开单医生名称,门诊卡号,开单科室,执行科室名称,费用名称,费用分类,单价,患者姓名
```  

条件为：费用创建时间，开单科室ID
![](自助报表系统使用文档.files/image088.jpg)     
![](自助报表系统使用文档.files/image089.jpg)    
##### 2.创建基本报表
使用设计向导，选择"示例三_子报表数据集1"数据集制作好一个基本的报表。
![](自助报表系统使用文档.files/image090.jpg)   
##### 3.添加子报表
![](自助报表系统使用文档.files/image091.jpg)
![](自助报表系统使用文档.files/image092.jpg)     
点击加号按钮，在新页签中选择"示例三_子报表数据集2"数据集选择添加进来。
![](自助报表系统使用文档.files/image093.jpg)   
![](自助报表系统使用文档.files/image094.jpg)   
点击查询表单按钮，删掉原来设计的时间条件，重新拖拽设置，以使它能够被两个数据集同时使用。
![](自助报表系统使用文档.files/image095.jpg)    
在报表设计器中添加一个报表尾，在新加的报表尾中，添加一个子报表。修改这个子报表的名称为"示例三_子报表数据集2"，名称和子报表的数据集保持一致。双击子报表进入子报表设计器。在子报表设计器手动添加一个明细网格。
![](自助报表系统使用文档.files/image096.jpg)   
![](自助报表系统使用文档.files/image097.jpg)     
点击"子报表明细数据"按钮。此时页面重新刷新。我们重新双击击子报表进入子报表设计器。
![](自助报表系统使用文档.files/image098.jpg)    
数据集右键点击"自动生成字段"。  
![](自助报表系统使用文档.files/image099.jpg)   
![](自助报表系统使用文档.files/image100.jpg)    
在子报表设计器中依次点击上图所示两个按钮。生成明细网格中的字段如上图。      
这样我们完成了最简单的子报表制作。生成页面预览，效果如下图。    
![](自助报表系统使用文档.files/image101.png)        
##### 4.制作关联子报表    
现在医院提出了新的要求，希望通过点击上方的汇总数据中的单个科室，改变下方的明细显示内容为该科室内容。    
![](自助报表系统使用文档.files/image102.jpg)    
打开查询条件设计页面，拖拽"开单科室"条件到编辑区域。点击编辑按钮。    
![](自助报表系统使用文档.files/image103.jpg)     
设置"隐藏属性"为"是"。设置默认值为"#{开单科室ID}"。    
默认值设置说明：填写模式为#{+字段+ }。以本报表为例，我们点击明细网格中的行时，希望将记录集中"开单科室ID"做条件传递给子报表，填写值就是 #{开单科室ID}。    
![](自助报表系统使用文档.files/image104.jpg)    
我们重新生成报表页面，查看效果。（注意：因锐浪程序限制，关联报表仅支持查询视图展示。）    
1.首次查询，子报表中无内容。    
![](自助报表系统使用文档.files/image105.jpg)    
2.点击上方明细网格中的任意一行。出现对应查询内容。    
![](自助报表系统使用文档.files/image106.jpg)    
3.重新双击上方明细网格中的另外一行。子报表中的内容切换。    
![](自助报表系统使用文档.files/image107.jpg)    
#### 2.2.4 数据集其他设置
##### 1. TOP    
![](自助报表系统使用文档.files/image108.jpg)    
在报表属性设置中填写想要的TOP值。    
##### 2.ORDER    
![](自助报表系统使用文档.files/image109.jpg)    
在数据集属性设置中的排序多选框中选择想要排序的字段。    
![](自助报表系统使用文档.files/image110.jpg)    
点击排序类型进入设置弹窗，对排序方式进行修改。    
##### 3.COUNT    
![](自助报表系统使用文档.files/image111.jpg)   
在数据集属性设置中，添加统计选项选择"是"，在左侧显示列表中添加count。    
##### 4.HAVING条件    
切换到查询字段设置，点击添加聚合字段按钮。在弹窗中添加自定义聚合函数字段作为HAVING条件。                                                                                                                                                                                                                                                                                                                                        
![](自助报表系统使用文档.files/image112.jpg)   
![](自助报表系统使用文档.files/image113.jpg)   
##### 5.自定义条件    
![](自助报表系统使用文档.files/image114.jpg)   
如果我们要给数据集查询脚本写死一些条件，点击数据集页面右上方的"自定义"按钮。下方出现自定义脚本框。在自定义脚本框中输入想要的条件SQL就可以。    
举例：现在要做一个急诊科门诊收入明细查询。我们可以在自定义脚本框中输入"开单科室ID=21"，保存后实际数据集脚本如下。(开单科室ID=21) 就是我们维护的自定义条件。    
  
```sql
SELECT 实际支付金额, 单价, 患者姓名, 数量, 费用分类, 费用名称, 门诊卡号, 开单医生名称, 开单科室, 执行科室名称 FROM [ZYREPORTDS].[dbo].[门诊_费用明细视图_LV0] WITH(NOLOCK) WHERE 1=1 AND (开单科室ID=21) #{WHERE}    
```  

报表平台中的部分数据集中已经维护了自定义条件，为了降低报表迁移难度，我们设计了一些公用条件来替代自定义脚本中的固定值。打开"门诊妇科收入统计数据集"，可以看到科室ID字段为蓝色显示。    
![](自助报表系统使用文档.files/image115.jpg) 
![](自助报表系统使用文档.files/image116.jpg)     
在公共条件维护菜单中，找到"妇科门诊科室ID"项目，修改条件SQL为医院实际条件。这里我们先修改成 "=31"。 完成修改后，重新打开"门诊妇科收入统计数据集"，看到数据集中的条件已经跟随发生改变。    
![](自助报表系统使用文档.files/image117.jpg)   
![](自助报表系统使用文档.files/image118.jpg)   
我们自己制作数据集时也可以引用公共条件中维护的条件。在脚本框中右键，点击关联按钮。弹出公共条件选择框。找到想要使用的条件，点击绑定按钮，添加到自定义脚本中。    
![](自助报表系统使用文档.files/image119.jpg)    
![](自助报表系统使用文档.files/image120.jpg)    
#### 2.2.5查询条件其他设置    
![](自助报表系统使用文档.files/image121.jpg)   
##### 1.默认打印机    
设计固定的点打印机名称，多打印机情况下打印时，不需要再进行打印机选择。    
##### 2.自动加载数据    
勾选生效，打开报表页面时直接根据默认条件查询出结果显示。    
##### 3.点击标题排序    
勾选后，查询视图下，可以点击标题对数据进行排序展示。    
##### 4.查询TOP设置    
![](自助报表系统使用文档.files/image122.jpg)   
勾选查询TOP设置出现 隐藏框和查询条数框。    
查询条数中可以设置默认查询条数，也可以在查询时进行修改。    
勾选隐藏框查询条数将隐藏作为默认条件。    
## 3 菜单功能介绍    
### 3.1 首页-系统公告    
![](自助报表系统使用文档.files/image123.jpg)   
功能：提供报表平台信息展示，报表数据文件迁移功能。    
### 3.2 报表文件管理-报表仓库    
![](自助报表系统使用文档.files/image124.jpg)   
功能：展示已完成报表列表。提供报表重新编辑，报表重新生成，报表页面预览，报表发布使用等功能。    
操作：    
1．报表编辑：点击操作栏下的编辑按钮或双击记录行进入报表编辑器界面。    
![](自助报表系统使用文档.files/image125.jpg)       
2．重新生成：选中想要重新生成报表htm页面的报表（支持多选），点击高级按钮，点击"重新生成报表"按钮，系统将按照最新的报表设置重新生成对应htm页面。    
3．页面预览，点击操作栏中的预览按钮，在浏览器新页签中打开报表htm页面。    
4. 报表发布，点击操作栏中的发布按钮，弹出报表发布窗口，选择菜单位置，填写菜单信息，点击保存。    
（注意：报表发布保存后在对应系统中创建菜单，还需要到对应系统中勾选相关权限才能对客户可见。）    
5. 报表作废，勾选无用的报表，点击"作废"按钮，将无用报表移动到回收站。    
![](自助报表系统使用文档.files/image126.jpg)   
### 3.3 报表文件管理-回收站    
![](自助报表系统使用文档.files/image127.jpg)   
功能：将作废报表放入回收站，可通过启用操作还原报表，防止误操作。    
操作：1.启用，勾选想要恢复启用状态的报表，点击启用按钮，恢复为启用状态。    
      2.清除，勾选报表点击清除按钮，将彻底删除报表信息。谨慎使用！    
### 3.4 报表设计管理-报表设计向导    
![](自助报表系统使用文档.files/image128.jpg)   
功能：进行向导化的报表制作。具体使用方式将在目录"3.2报表制作"中详细介绍。    
### 3.5 报表设计管理-报表设计器    
![](自助报表系统使用文档.files/image129.jpg)   
编辑器页面功能介绍：    
左侧栏功能有，    
1.	数据集列表。快捷编辑报表对应数据集，更换报表数据集，添加多个报表数据集（父子报表）。    
2.	参数数据源。很多情况下我们需要通过脚本查询出数据作为报表参数。参数数据源功能提供参数脚本维护功能，具体的使用方式将在目录"自定义报表参数"中详细介绍。    
上方菜单功能    
1.	查询表单。点击查询表单进入报表条件设计界面，具体操作同向导中的查询条件设置完全相同。    
2.	报表参数。自动获取设置好的报表条件生成报表参数。    
3.	明细网格。锐浪明细网格重置字段功能，当报表对应数据集发生改变时，点击此按钮获取最新数据集字段。    
4.	生成预览视图报表。当前设置的报表条件和报表样式，自动生成可使用的预览视图HTM页面供用户使用。    
5.	生成查询视图报表。当前设置的报表条件和报表样式，自动生成可使用的查询视图HTM页面供用户使用。    
6.	查看预览报表url，生成报表HTM页面后，点击此按钮直接打开生成的报表HTM页面。    

### 3.6 数据集管理-数据集维护    
![](自助报表系统使用文档.files/image130.jpg)   
数据集定义：提供报表明细网格数据的脚本。    
功能：展示已有数据集列表，新建、编辑数据集。    
操作：1.新建数据集，点击"新增"按钮，打开数据集信息维护页面，填写相应数据集信息，选择数据源后，点击保存按钮进入数据集脚本设计页面。具体数据集脚本维护方式在目录"2.2报表制作"中详细介绍。    
![](自助报表系统使用文档.files/image131.jpg)    
2.更新，点击操作栏中的"更新按钮"，打开数据集信息维护界面，填写完需要更改的信息后点击"修改"按钮保存修改。    
![](自助报表系统使用文档.files/image132.jpg)    
3.删除功能,点击删除功能删除没有使用的数据集。    
4.修改数据集说明，点击"说明"按钮查看修改数据集的说明文本。    
![](自助报表系统使用文档.files/image133.jpg)    
5.复制数据集，点击"复制"按钮，在弹窗中填写新数据集信息后点击"确定"按钮。将复制原数据集所有内容到新数据集中。    
![](自助报表系统使用文档.files/image134.jpg)    
6.点击"报表"按钮，展示所有使用此数据集的报表。    
### 3.7 数据集管理-公共条件维护    
![](自助报表系统使用文档.files/image135.jpg)    
公共条件定义：可以被多个数据集同时使用，在不同医院有不同取值甚至是不同条件字段的限定条件。    
使用目的：增加报表在不同医院的复用能力，减少报表迁移工作量。    
功能：1.新增公共条件，点击右上方绿色+号按钮，在四个内容框中添加维护条件内容，点击新增按钮保存。    
2.修改公共条件，点击左侧列表中的条件，在右侧维护框中完成内容修改，点击保存按钮完成修改。    
注意：修改公共条件将同步修改所有含有此条件的数据集脚本，请谨慎使用避免误操作。    
### 3.8 数据源管理-数据源维护    
![](自助报表系统使用文档.files/image136.jpg)    
数据源定义：提供医院业务数据的表、视图、存储过程。    
功能：初始化数据源信息。    
操作步骤：1.首先在SQLServer数据库中创建好使用的数据源视图。    
![](自助报表系统使用文档.files/image137.jpg)    
2.回到数据源维护菜单，在数据源列表中选择刚建好的视图。    
![](自助报表系统使用文档.files/image138.jpg)    
3.修改数据源名称，选择正确的数据库服务器，点击初始化按钮。    
![](自助报表系统使用文档.files/image139.jpg)    
4.点击获取视图字段按钮，按需要对字段列表进行编辑，最点点击右侧保存按钮，保存视图字段列表。    
![](自助报表系统使用文档.files/image140.jpg)    
注意：视图数据源维护完成后，需要到"2.12数据源管理-分类管理"菜单下，将视图数据源分配到相应的分类下才可以使用。如果视图字段有变动，需要到"2.12数据源管理-分类管理"菜单下进行修改。具体操作方式将在"2.12数据源管理-分类管理"目录下详细介绍。    
### 3.9 数据源管理-存储过程数据源维护    
![](自助报表系统使用文档.files/image141.jpg)    
如果报表脚本过于复杂，无法通过简单的视图查询到最终想要的数据。可以使用存储过程数据源功能制作。    
注意：在制作存储过程时，不要直接用存储过程返回数据，需要先将最终查询数据存储在临时表中。在写存储过程时请参考以下示例。    

``` sql 


------存储过程示例开始------
USE [ZYREPORTDS]
GO

/****** Object:  StoredProcedure [dbo].[住院_收款员发票预交金结账查询存储过程]Script Date: 2019-07-16 15:39:39 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[住院_收款员发票预交金结账查询存储过程] --CREATE
  @BTime DATETIME,
  @ETime DATETIME,
  @TABLENAME VARCHAR(100)
AS
BEGIN

SELECT   A.TALLY_SERIAL ,
 SUM(B.AMOUNT) AMOUNT
INTO #TEMP_ZYJJ
FROM ZY.[IN].IN_TALLY_SERIAL A WITH ( NOLOCK )
 LEFT JOIN ZY.[IN].PREPAY_RECORD B WITH ( NOLOCK ) ON B.TALLY_SERIAL = A.TALLY_SERIAL
WHEREA.TALLY_TIME >= @BTime
 AND A.TALLY_TIME <= @ETIME
 AND A.FLAG_INVALID = 0
 AND B.PREPAY_TYPE IN ( 1, 2, 4 )
GROUP BY A.TALLY_SERIAL;

SELECT   AA.TALLY_SERIAL ,
 SUM(发票张数) 发票张数 ,
 SUM(住院费用) 住院费用 ,
 SUM(有效票数) 有效票数 ,
 SUM(有效金额) 有效金额 ,
 SUM(冲预交金) 冲预交金 ,
 SUM(补退金额) 补退金额 ,
 SUM(退票张数) 退票张数 ,
 SUM(退票金额) 退票金额 ,
 SUM(退票补退金额) 退票补退金额
INTO #TEMP_FPXX
FROM (   SELECT A.TALLY_SERIAL ,
CASE WHEN B.AMOUNT > 0 THEN 1
 ELSE 0
END AS 发票张数 ,
B.AMOUNT AS 住院费用 ,
CASE WHEN B.FLAG_INVALID = 0 THEN 1
 ELSE 0
END AS 有效票数 ,
CASE WHEN B.FLAG_INVALID = 0 THEN B.AMOUNT
 ELSE 0
END AS 有效金额 ,
CASE WHEN B.AMOUNT > 0 THEN B.PREPAY_TOTAL
 ELSE -B.PREPAY_TOTAL
END AS 冲预交金 ,
B.NEED_AMOUNT 补退金额 ,
CASE WHEN B.AMOUNT < 0 THEN 1
 ELSE 0
END AS 退票张数 ,
CASE WHEN B.AMOUNT < 0 THEN -B.AMOUNT
 ELSE 0
END AS 退票金额 ,
CASE WHEN B.AMOUNT < 0 THEN B.NEED_AMOUNT
 ELSE 0
END AS 退票补退金额
 FROM   ZY.[IN].IN_TALLY_SERIAL A WITH ( NOLOCK )
LEFT JOIN ZY.[IN].IN_SETTLE_MAIN B WITH ( NOLOCK ) ON B.TALLY_SERIAL = A.TALLY_SERIAL
 WHERE  A.TALLY_TIME >= @BTime
AND A.TALLY_TIME <= @ETIME
AND A.FLAG_INVALID = 0 ) AA
GROUP BY AA.TALLY_SERIAL;

SELECT   A.TALLY_SERIAL ,
 COUNT(1) 回收押金数
INTO #TEMP_HSYJZS
FROM ZY.[IN].IN_TALLY_SERIAL A WITH ( NOLOCK )
 LEFT JOIN ZY.[IN].IN_SETTLE_MAIN B WITH ( NOLOCK ) ON B.TALLY_SERIAL = A.TALLY_SERIAL
 LEFT JOIN ZY.[IN].PREPAY_RECORD c WITH ( NOLOCK ) ON c.SETTLE_ID = B.SETTLE_ID
WHEREA.TALLY_TIME >= @BTime
 AND A.TALLY_TIME <= @ETIME
 AND A.FLAG_INVALID = 0
 AND c.PREPAY_TYPE IN ( 1, 2 )
GROUP BY A.TALLY_SERIAL;

SELECT   A.TALLY_SERIAL ,
 SUM(c.AMOUNT) 统筹支付
INTO #TEMP_TCZF
FROM ZY.[IN].IN_TALLY_SERIAL A WITH ( NOLOCK )
 LEFT JOIN ZY.[IN].PREPAY_RECORD B WITH ( NOLOCK ) ON B.TALLY_SERIAL = A.TALLY_SERIAL
 LEFT JOIN ZY.[IN].PREPAY_PAYMENT_RECORD c WITH ( NOLOCK ) ON c.PREPAY_ID = B.PREPAY_ID
WHEREA.TALLY_TIME >= @BTime
 AND A.TALLY_TIME <= @ETIME
 AND A.FLAG_INVALID = 0
 AND c.PAY_TYPE_ID IN ( 4 )
GROUP BY A.TALLY_SERIAL;

SELECT   A.TALLY_SERIAL ,
 SUM(c.AMOUNT) 实收金额
INTO #TEMP_SSJE
FROM ZY.[IN].IN_TALLY_SERIAL A WITH ( NOLOCK )
 LEFT JOIN ZY.[IN].PREPAY_RECORD B WITH ( NOLOCK ) ON B.TALLY_SERIAL = A.TALLY_SERIAL
 LEFT JOIN ZY.[IN].PREPAY_PAYMENT_RECORD c WITH ( NOLOCK ) ON c.PREPAY_ID = B.PREPAY_ID
WHEREA.TALLY_TIME >= @BTime
 AND A.TALLY_TIME <= @ETIME
 AND A.FLAG_INVALID = 0
 AND c.PAY_TYPE_ID NOT IN ( 4 )
GROUP BY A.TALLY_SERIAL;

EXEC('SELECT A.TALLY_SERIAL 结账序列号,
   USERINFO.USER_CODE 收款员账号,
   USERINFO.UESR_NAME 收款员姓名,
   D.AMOUNT 总预交金 ,
   B.发票张数 ,
   B.住院费用 ,
   B.有效票数 ,
   B.有效金额 ,
   C.回收押金数 ,
   B.冲预交金 ,
   E.统筹支付 ,
   B.补退金额 ,
   F.实收金额 ,
   B.退票金额 ,
   B.退票补退金额
	INTO '+@TABLENAME+'
FROM   ZY.[IN].IN_TALLY_SERIAL A WITH ( NOLOCK )
   LEFT JOIN #TEMP_FPXX B WITH ( NOLOCK ) ON B.TALLY_SERIAL = A.TALLY_SERIAL
   LEFT JOIN #TEMP_HSYJZS C WITH ( NOLOCK ) ON C.TALLY_SERIAL = A.TALLY_SERIAL
   LEFT JOIN #TEMP_ZYJJ D WITH ( NOLOCK ) ON D.TALLY_SERIAL = A.TALLY_SERIAL
   LEFT JOIN #TEMP_TCZF E WITH ( NOLOCK ) ON E.TALLY_SERIAL = A.TALLY_SERIAL
   LEFT JOIN #TEMP_SSJE F WITH ( NOLOCK ) ON F.TALLY_SERIAL = A.TALLY_SERIAL
   LEFT JOIN COMM.COMM.USERINFO_VIEW USERINFO WITH ( NOLOCK ) ON USERINFO.USER_SYS_ID = A.OPERATOR_ID
	   WHERE A.FLAG_INVALID=0 AND (B.TALLY_SERIAL IS NOT NULL OR D.TALLY_SERIAL IS NOT NULL)')

DROP TABLE #TEMP_ZYJJ ,
   #TEMP_FPXX ,
   #TEMP_HSYJZS ,
   #TEMP_TCZF ,
   #TEMP_SSJE
END
GO

------存储过程示例结束------
```


2.在sqlserver中创建好存储过程后，回到维护界面，填写必要信息。点击生成条件按钮。在弹窗中修改条件字段为实际的条件数值（字符串日期类需要加引号，数值不用加引号），点击"确定"按钮。系统自动得出存储过程条件字段和查询字段。点击保存按钮保存字段信息。    
注意：存储过程数据源维护完成后，需要到"2.12数据源管理-分类管理"菜单下，将数据源分配到相应的分类下才可以使用。如果存储过程字段有变动，需要到"2.12数据源管理-分类管理"菜单下进行修改。具体操作方式将在"2.12数据源管理-分类管理"目录下详细介绍。 
![](自助报表系统使用文档.files/image142.jpg)     
![](自助报表系统使用文档.files/image143.jpg)    
![](自助报表系统使用文档.files/image144.jpg)    
![](自助报表系统使用文档.files/image145.jpg)      
### 3.10 数据源管理-查看配置    
![](自助报表系统使用文档.files/image146.jpg)    
### 3.11 数据源管理-添加配置    
![](自助报表系统使用文档.files/image147.jpg)    
### 3.12 数据源管理-分类管理    
![](自助报表系统使用文档.files/image148.jpg)    
建立数据源后，需要将数据源对应到相应的分类下。    
1.选择右侧分类节点，点击"添加对应关系按钮"。    
![](自助报表系统使用文档.files/image149.jpg)    
2.在弹窗中通过检索，找到已初始化的数据源，点击保存按钮，保存数据源分类。    
![](自助报表系统使用文档.files/image150.jpg)    
3.数据源字段修改。点击字段维护按钮。    
(1).视图数据源修改字段，在维护页面中点击"获取视图字段"按钮，系统自动读取最新的视图字段。    
(2).存储过程数据源修改字段，通过"删除"和"添加字段"按钮，实现字段的增删操作。（如果存储过程的条件个数或者顺序发生变化，还需要对执行存储过程的脚本进行修改，请看第四步。）    
确认无误后点击保存按钮。    
![](自助报表系统使用文档.files/image151.jpg)    
![](自助报表系统使用文档.files/image152.jpg)  
 
4.存储过程数据源条件字段修改    
如果存储过程的条件个数或者顺序发生变化，还需要对执行存储过程的脚本进行修改。选中需要修改条件的存储过程。点击"修改存储过程执行语句"按钮。修改括号中的存储过程条件字段。修改时请注意，条件名称可以不同，比如存储过程中实际条件是@BTime，我们可以用汉字"开始时间"替代。条件顺序必须相同。最后的TABLE_NAME字段请不要修改。如果条件发生改变，没做第三步的字段修改，还要到字段维护中修改为最新字段。    
![](自助报表系统使用文档.files/image153.jpg)   
### 3.13 服务器管理-数据库维护    
![](自助报表系统使用文档.files/image154.jpg)   
功能：维护HIS数据库信息。    
操作：双击"HIS服务器"记录，修改最上方出现的信息为医院最新信息。点击修改按钮保存。     
### 3.14 服务器管理-服务器维护    
![](自助报表系统使用文档.files/image155.jpg)   
功能：维护HIS IIS服务器信息。    
操作：双击"HIS Web服务器地址"记录，修改最上方出现的信息为医院HIS服务器实际IP和端口。点击修改按钮保存。     

*

